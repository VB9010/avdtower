<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional SCADA & P&ID System - VDU Control</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0f1c, #1a2332);
            color: #ffffff;
            font-size: 12px;
            overflow: hidden;
        }
        
        .scada-header {
            background: linear-gradient(135deg, #1e3a5f, #2c5282);
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #3182ce;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        
        .plant-info h1 {
            font-size: 1.4em;
            margin-bottom: 2px;
        }
        
        .plant-info .unit-tag {
            font-size: 0.9em;
            color: #63b3ed;
        }
        
        .header-status {
            display: flex;
            gap: 20px;
            align-items: center;
            font-size: 11px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .status-led {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .led-green { background: #48bb78; }
        .led-yellow { background: #ed8936; }
        .led-red { background: #e53e3e; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .main-scada {
            display: grid;
            grid-template-columns: 250px 1fr 280px;
            grid-template-rows: 1fr 40px;
            height: calc(100vh - 60px);
        }
        
        .left-sidebar {
            background: linear-gradient(135deg, rgba(26, 35, 50, 0.95), rgba(30, 58, 95, 0.95));
            border-right: 1px solid rgba(49, 130, 206, 0.3);
            overflow-y: auto;
        }
        
        .main-display {
            background: radial-gradient(ellipse at center, #1a2332, #0a0f1c);
            position: relative;
            overflow: hidden;
        }
        
        .right-panel {
            background: linear-gradient(135deg, rgba(26, 35, 50, 0.95), rgba(30, 58, 95, 0.95));
            border-left: 1px solid rgba(49, 130, 206, 0.3);
            overflow-y: auto;
        }
        
        .status-bar {
            grid-column: 1 / -1;
            background: #1a202c;
            border-top: 1px solid #4a5568;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            font-size: 10px;
        }
        
        .sidebar-section {
            padding: 12px;
            border-bottom: 1px solid rgba(49, 130, 206, 0.2);
        }
        
        .section-title {
            color: #3182ce;
            font-weight: 600;
            font-size: 11px;
            margin-bottom: 8px;
            border-bottom: 1px solid #3182ce;
            padding-bottom: 3px;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin-bottom: 8px;
        }
        
        .kpi-item {
            background: rgba(26, 32, 44, 0.8);
            padding: 6px;
            border-radius: 4px;
            text-align: center;
            border: 1px solid #4a5568;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .kpi-item:hover {
            border-color: #3182ce;
            transform: scale(1.02);
        }
        
        .kpi-value {
            font-size: 13px;
            font-weight: bold;
            color: #48bb78;
            font-family: 'Courier New', monospace;
        }
        
        .kpi-label {
            font-size: 9px;
            color: #a0aec0;
            margin-top: 2px;
        }
        
        .alarm-item {
            background: rgba(26, 32, 44, 0.8);
            padding: 6px;
            margin: 3px 0;
            border-radius: 3px;
            font-size: 10px;
            border-left: 3px solid;
            cursor: pointer;
        }
        
        .alarm-critical { border-color: #e53e3e; background: rgba(229, 62, 62, 0.1); }
        .alarm-warning { border-color: #ed8936; background: rgba(237, 137, 54, 0.1); }
        .alarm-info { border-color: #3182ce; background: rgba(49, 130, 206, 0.1); }
        
        /* P&ID Elements */
        .process-diagram {
            position: relative;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(49, 130, 206, 0.1), transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(72, 187, 120, 0.1), transparent 50%);
        }
        
        .equipment {
            position: absolute;
            border: 2px solid #3182ce;
            background: linear-gradient(45deg, #2d3748, #4a5568);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .equipment:hover {
            border-color: #63b3ed;
            box-shadow: 0 0 15px rgba(99, 179, 237, 0.5);
            /* Removed transform: scale(1.05) to prevent jumping */
        }
        
        .tower {
            width: 60px;
            height: 400px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            border-radius: 8px;
            background: linear-gradient(to bottom, 
                #4a5568 0%, 
                #2d3748 25%, 
                #1a202c 50%, 
                #2d3748 75%, 
                #4a5568 100%);
            box-shadow: 
                0 0 20px rgba(49, 130, 206, 0.3),
                inset 0 0 20px rgba(0,0,0,0.3);
        }
        
        .tower:hover {
            /* Preserve the original transform while adding hover effects */
            transform: translate(-50%, -50%);
            border-color: #63b3ed;
            box-shadow: 
                0 0 25px rgba(99, 179, 237, 0.6),
                inset 0 0 20px rgba(0,0,0,0.3);
        }
        
        .condenser {
            width: 80px;
            height: 30px;
            left: 65%;
            top: 20%;
            border-radius: 6px;
            background: repeating-linear-gradient(
                45deg,
                #4a5568,
                #4a5568 4px,
                #2d3748 4px,
                #2d3748 8px
            );
        }
        
        .reboiler {
            width: 80px;
            height: 30px;
            left: 65%;
            top: 75%;
            border-radius: 6px;
            background: repeating-linear-gradient(
                45deg,
                #e53e3e,
                #e53e3e 4px,
                #c53030 4px,
                #c53030 8px
            );
        }
        
        .pump {
            width: 25px;
            height: 25px;
            left: 20%;
            top: 15%;
            border-radius: 50%;
            background: radial-gradient(circle, #3182ce, #2c5282);
        }
        
        .vessel {
            width: 40px;
            height: 50px;
            border-radius: 8px;
            background: linear-gradient(to bottom, #4a5568, #2d3748);
        }
        
        .reflux-drum {
            width: 40px;
            height: 50px;
            left: 65%;
            top: 30%;
            border-radius: 8px;
            background: linear-gradient(to bottom, #4a5568, #2d3748);
        }
        
        .pipe {
            position: absolute;
            border: 2px solid #63b3ed;
            background: linear-gradient(90deg, rgba(99, 179, 237, 0.3), rgba(99, 179, 237, 0.1));
        }
        
        .pipe-main { border-color: #3182ce; border-width: 3px; }
        .pipe-product { border-color: #48bb78; border-width: 2px; }
        .pipe-utility { border-color: #ed8936; border-width: 2px; }
        .pipe-steam { border-color: #e53e3e; border-width: 2px; }
        
        .flow-arrow {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 6px solid #3182ce;
            border-top: 4px solid transparent;
            border-bottom: 4px solid transparent;
            animation: flow-pulse 1s infinite;
        }
        
        @keyframes flow-pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .instrument-tag {
            position: absolute;
            background: rgba(26, 32, 44, 0.95);
            border: 1px solid #3182ce;
            border-radius: 15px;
            padding: 4px 8px;
            font-size: 9px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 50px;
        }
        
        .instrument-tag:hover {
            background: rgba(49, 130, 206, 0.2);
            border-color: #63b3ed;
            transform: scale(1.1);
        }
        
        .tag-temp { border-color: #e53e3e; color: #fed7d7; }
        .tag-pressure { border-color: #48bb78; color: #c6f6d5; }
        .tag-flow { border-color: #3182ce; color: #bee3f8; }
        .tag-level { border-color: #ed8936; color: #fbd38d; }
        
        .valve {
            position: absolute;
            width: 16px;
            height: 16px;
            background: linear-gradient(45deg, #48bb78, #38a169);
            border: 1px solid #2d7738;
            transform: rotate(45deg);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .valve:hover {
            box-shadow: 0 0 10px rgba(72, 187, 120, 0.6);
            transform: rotate(45deg) scale(1.2);
        }
        
        .valve-open {
            background: linear-gradient(45deg, #48bb78, #38a169);
            box-shadow: 0 0 8px rgba(72, 187, 120, 0.4);
        }
        
        .valve-closed {
            background: linear-gradient(45deg, #e53e3e, #c53030);
            box-shadow: 0 0 8px rgba(229, 62, 62, 0.4);
        }
        
        .control-loop {
            position: absolute;
            border: 1px dashed #ed8936;
            border-radius: 4px;
            background: rgba(237, 137, 54, 0.05);
            pointer-events: none;
        }
        
        .trend-mini {
            width: 100%;
            height: 60px;
            background: rgba(26, 32, 44, 0.8);
            border-radius: 4px;
            margin: 6px 0;
            position: relative;
            cursor: pointer;
        }
        
        .trend-mini:hover {
            background: rgba(49, 130, 206, 0.1);
        }
        
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .popup-content {
            background: linear-gradient(135deg, #2d3748, #4a5568);
            border: 2px solid #3182ce;
            border-radius: 10px;
            padding: 20px;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        
        .popup-header {
            color: #3182ce;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 2px solid #3182ce;
            padding-bottom: 8px;
        }
        
        .popup-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: #e53e3e;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .navigation-tabs {
            display: flex;
            background: rgba(26, 32, 44, 0.8);
            border-radius: 6px;
            margin-bottom: 8px;
            overflow: hidden;
        }
        
        .nav-tab {
            flex: 1;
            padding: 6px 8px;
            text-align: center;
            background: transparent;
            border: none;
            color: #a0aec0;
            cursor: pointer;
            font-size: 10px;
            transition: all 0.2s;
        }
        
        .nav-tab.active {
            background: #3182ce;
            color: white;
        }
        
        .nav-tab:hover {
            background: rgba(49, 130, 206, 0.3);
        }
        
        .quick-actions {
            display: flex;
            gap: 4px;
            margin-top: 8px;
        }
        
        .action-btn {
            flex: 1;
            padding: 4px 6px;
            background: linear-gradient(135deg, #3182ce, #2c5282);
            border: none;
            border-radius: 4px;
            color: white;
            font-size: 9px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background: linear-gradient(135deg, #2c5282, #2a4365);
            transform: translateY(-1px);
        }
        
        .tray-indicator {
            position: absolute;
            width: 4px;
            height: 2px;
            background: #ed8936;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 3px rgba(237, 137, 54, 0.6);
        }
    </style>
</head>
<body>
    <div class="scada-header">
        <div class="plant-info">
            <h1>🏭 REFINERY CONTROL SYSTEM</h1>
            <div class="unit-tag">Unit 100 - Vacuum Distillation Unit (VDU)</div>
        </div>
        <div class="header-status">
            <div class="status-item">
                <div class="status-led led-green"></div>
                <span>SYSTEM ONLINE</span>
            </div>
            <div class="status-item">
                <div class="status-led led-green"></div>
                <span>DCS COMM</span>
            </div>
            <div class="status-item">
                <div class="status-led led-yellow"></div>
                <span id="alarmCount">2 ALARMS</span>
            </div>
            <div class="status-item">
                <span>👨‍💼 J.SMITH</span>
            </div>
            <div class="status-item">
                <span id="currentTime">14:25:33</span>
            </div>
        </div>
    </div>
    
    <div class="main-scada">
        <!-- Left Sidebar - Key Parameters & Alarms -->
        <div class="left-sidebar">
            <div class="sidebar-section">
                <div class="section-title">🎯 KEY PERFORMANCE</div>
                <div class="kpi-grid">
                    <div class="kpi-item" onclick="showDetails('throughput')">
                        <div class="kpi-value" id="kpi_throughput">250.5</div>
                        <div class="kpi-label">m³/h Feed</div>
                    </div>
                    <div class="kpi-item" onclick="showDetails('vacuum')">
                        <div class="kpi-value" id="kpi_vacuum">40.2</div>
                        <div class="kpi-label">mmHg Vacuum</div>
                    </div>
                    <div class="kpi-item" onclick="showDetails('efficiency')">
                        <div class="kpi-value" id="kpi_efficiency">94.2</div>
                        <div class="kpi-label">% Recovery</div>
                    </div>
                    <div class="kpi-item" onclick="showDetails('energy')">
                        <div class="kpi-value" id="kpi_energy">89.7</div>
                        <div class="kpi-label">MW Reboiler</div>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">🌡️ CRITICAL TEMPS</div>
                <div class="kpi-grid">
                    <div class="kpi-item" onclick="showTempProfile()">
                        <div class="kpi-value" id="temp_top">245.2</div>
                        <div class="kpi-label">°C Top</div>
                    </div>
                    <div class="kpi-item" onclick="showTempProfile()">
                        <div class="kpi-value" id="temp_feed">355.1</div>
                        <div class="kpi-label">°C Feed</div>
                    </div>
                    <div class="kpi-item" onclick="showTempProfile()">
                        <div class="kpi-value" id="temp_bottom">385.8</div>
                        <div class="kpi-label">°C Bottom</div>
                    </div>
                    <div class="kpi-item" onclick="showTempProfile()">
                        <div class="kpi-value" id="temp_delta">140.6</div>
                        <div class="kpi-label">°C ΔT</div>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">⚠️ ACTIVE ALARMS</div>
                <div style="max-height: 120px; overflow-y: auto;" id="alarmsList">
                    <div class="alarm-item alarm-warning" onclick="acknowledgeAlarm(this)">
                        <div>14:25:15 - TI-T23 High Temp Warning</div>
                        <div style="font-size: 8px; color: #a0aec0;">432.1°C > 430°C</div>
                    </div>
                    <div class="alarm-item alarm-info" onclick="acknowledgeAlarm(this)">
                        <div>14:24:52 - FIC-102 Setpoint Changed</div>
                        <div style="font-size: 8px; color: #a0aec0;">New SP: 625.0 m³/h</div>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">📊 MINI TRENDS</div>
                <div class="trend-mini" onclick="showTrendDetail('temperature')">
                    <canvas id="miniTempChart" width="200" height="60"></canvas>
                </div>
                <div class="trend-mini" onclick="showTrendDetail('pressure')">
                    <canvas id="miniPressChart" width="200" height="60"></canvas>
                </div>
            </div>
            
            <div class="navigation-tabs">
                <button class="nav-tab active" onclick="switchView('overview')">Overview</button>
                <button class="nav-tab" onclick="switchView('control')">Control</button>
                <button class="nav-tab" onclick="switchView('trends')">Trends</button>
                <button class="nav-tab" onclick="switchView('maintenance')">Maint</button>
            </div>
        </div>
        
        <!-- Main P&ID Display -->
        <div class="main-display">
            <div class="process-diagram" id="processDisplay">
                <!-- Main Tower -->
                <div class="equipment tower" onclick="showEquipmentDetail('tower')" title="C-101: Vacuum Distillation Tower">
                    <!-- Tray indicators -->
                    <div class="tray-indicator" style="top: 5%;"></div>
                    <div class="tray-indicator" style="top: 15%;"></div>
                    <div class="tray-indicator" style="top: 25%;"></div>
                    <div class="tray-indicator" style="top: 35%;"></div>
                    <div class="tray-indicator" style="top: 45%;"></div>
                    <div class="tray-indicator" style="top: 55%;"></div>
                    <div class="tray-indicator" style="top: 65%;"></div>
                    <div class="tray-indicator" style="top: 75%;"></div>
                    <div class="tray-indicator" style="top: 85%;"></div>
                    <div class="tray-indicator" style="top: 95%;"></div>
                </div>
                
                <!-- Condenser -->
                <div class="equipment condenser" onclick="showEquipmentDetail('condenser')" title="E-101: Condenser"></div>
                
                <!-- Reboiler -->
                <div class="equipment reboiler" onclick="showEquipmentDetail('reboiler')" title="E-102: Reboiler"></div>
                
                <!-- Reflux Drum -->
                <div class="equipment reflux-drum" onclick="showEquipmentDetail('reflux-drum')" title="V-101: Reflux Drum"></div>
                
                <!-- Vacuum Pump -->
                <div class="equipment pump" onclick="showEquipmentDetail('vacuum-pump')" title="P-101: Vacuum Pump"></div>
                
                <!-- Main Process Pipes -->
                <!-- Feed Line -->
                <div class="pipe pipe-main" style="left: 20%; top: 60%; width: 25%; height: 3px;"></div>
                <div class="flow-arrow" style="left: 35%; top: 59.5%;"></div>
                
                <!-- Overhead Vapor -->
                <div class="pipe pipe-main" style="left: 48%; top: 20%; width: 3px; height: 15%;"></div>
                <div class="pipe pipe-main" style="left: 51%; top: 27%; width: 14%; height: 3px;"></div>
                
                <!-- Reflux -->
                <div class="pipe pipe-product" style="left: 51%; top: 40%; width: 14%; height: 3px;"></div>
                <div class="pipe pipe-product" style="left: 48%; top: 43%; width: 3px; height: 8%;"></div>
                
                <!-- Product Streams -->
                <div class="pipe pipe-product" style="left: 53%; top: 35%; width: 15%; height: 2px;"></div>
                <div class="pipe pipe-product" style="left: 53%; top: 45%; width: 15%; height: 2px;"></div>
                <div class="pipe pipe-product" style="left: 53%; top: 55%; width: 15%; height: 2px;"></div>
                <div class="pipe pipe-product" style="left: 53%; top: 65%; width: 15%; height: 2px;"></div>
                
                <!-- Bottom Product -->
                <div class="pipe pipe-main" style="left: 48%; top: 80%; width: 3px; height: 10%;"></div>
                <div class="pipe pipe-main" style="left: 51%; top: 87%; width: 14%; height: 3px;"></div>
                
                <!-- Steam -->
                <div class="pipe pipe-steam" style="left: 70%; top: 85%; width: 15%; height: 2px;"></div>
                
                <!-- Key Instruments -->
                <div class="instrument-tag tag-temp" style="left: 25%; top: 20%;" onclick="showInstrument('TI-101')">
                    <div>TI-101</div>
                    <div id="TI101_value">245.2°C</div>
                </div>
                
                <div class="instrument-tag tag-pressure" style="left: 15%; top: 15%;" onclick="showInstrument('PI-101')">
                    <div>PI-101</div>
                    <div id="PI101_value">40.2 mmHg</div>
                </div>
                
                <div class="instrument-tag tag-flow" style="left: 10%; top: 55%;" onclick="showInstrument('FI-101')">
                    <div>FI-101</div>
                    <div id="FI101_value">250.5 m³/h</div>
                </div>
                
                <div class="instrument-tag tag-temp" style="left: 75%; top: 35%;" onclick="showInstrument('TI-110')">
                    <div>TI-110</div>
                    <div id="TI110_value">301.3°C</div>
                </div>
                
                <div class="instrument-tag tag-temp" style="left: 75%; top: 55%;" onclick="showInstrument('TI-116')">
                    <div>TI-116</div>
                    <div id="TI116_value">355.1°C</div>
                </div>
                
                <div class="instrument-tag tag-temp" style="left: 25%; top: 85%;" onclick="showInstrument('TI-125')">
                    <div>TI-125</div>
                    <div id="TI125_value">423.7°C</div>
                </div>
                
                <div class="instrument-tag tag-level" style="left: 70%; top: 25%;" onclick="showInstrument('LI-101')">
                    <div>LI-101</div>
                    <div id="LI101_value">68.5%</div>
                </div>
                
                <!-- Control Valves -->
                <div class="valve valve-open" style="left: 35%; top: 58%;" onclick="showValve('FCV-101')" title="FCV-101: Feed Control Valve"></div>
                <div class="valve valve-open" style="left: 45%; top: 40%;" onclick="showValve('FCV-102')" title="FCV-102: Reflux Control Valve"></div>
                <div class="valve valve-open" style="left: 12%; top: 13%;" onclick="showValve('PCV-101')" title="PCV-101: Vacuum Control Valve"></div>
                <div class="valve valve-open" style="left: 67%; top: 33%;" onclick="showValve('LCV-201')" title="LCV-201: HVGO Level Control"></div>
                <div class="valve valve-open" style="left: 67%; top: 63%;" onclick="showValve('LCV-205')" title="LCV-205: Bottom Level Control"></div>
                
                <!-- Control Loops -->
                <div class="control-loop" style="left: 8%; top: 52%; width: 40%; height: 15%;"></div>
                <div class="control-loop" style="left: 22%; top: 15%; width: 30%; height: 15%;"></div>
                <div class="control-loop" style="left: 42%; top: 37%; width: 30%; height: 15%;"></div>
            </div>
        </div>
        
        <!-- Right Panel - Detailed Data -->
        <div class="right-panel">
            <div class="sidebar-section">
                <div class="section-title">🎛️ ACTIVE CONTROLLERS</div>
                <div style="font-size: 10px; space-y: 4px;">
                    <div style="display: flex; justify-content: space-between; margin: 3px 0; padding: 3px; background: rgba(26,32,44,0.5); border-radius: 3px;">
                        <span>TIC-101</span>
                        <span style="color: #48bb78;">AUTO</span>
                        <span style="color: #63b3ed;" id="TIC101_output">67.5%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 3px 0; padding: 3px; background: rgba(26,32,44,0.5); border-radius: 3px;">
                        <span>PIC-101</span>
                        <span style="color: #48bb78;">AUTO</span>
                        <span style="color: #63b3ed;" id="PIC101_output">58.9%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 3px 0; padding: 3px; background: rgba(26,32,44,0.5); border-radius: 3px;">
                        <span>FIC-101</span>
                        <span style="color: #48bb78;">AUTO</span>
                        <span style="color: #63b3ed;" id="FIC101_output">65.2%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 3px 0; padding: 3px; background: rgba(26,32,44,0.5); border-radius: 3px;">
                        <span>LIC-101</span>
                        <span style="color: #48bb78;">AUTO</span>
                        <span style="color: #63b3ed;" id="LIC101_output">45.3%</span>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">📊 PRODUCT FLOWS</div>
                <div style="font-size: 10px;">
                    <div style="display: flex; justify-content: space-between; margin: 2px 0;">
                        <span style="color: #f56565;">● HVGO</span>
                        <span id="hvgo_flow">37.5 m³/h</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 2px 0;">
                        <span style="color: #ed8936;">● LVGO</span>
                        <span id="lvgo_flow">62.5 m³/h</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 2px 0;">
                        <span style="color: #48bb78;">● Spindle</span>
                        <span id="spindle_flow">50.0 m³/h</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 2px 0;">
                        <span style="color: #9f7aea;">● Heavy Neutral</span>
                        <span id="hn_flow">45.0 m³/h</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 2px 0;">
                        <span style="color: #4a5568;">● Residuum</span>
                        <span id="resid_flow">55.0 m³/h</span>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">⚡ UTILITIES</div>
                <div style="font-size: 10px;">
                    <div style="display: flex; justify-content: space-between; margin: 2px 0;">
                        <span>Steam</span>
                        <span id="steam_flow">8,500 kg/h</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 2px 0;">
                        <span>Cooling Water</span>
                        <span id="cw_flow">450 m³/h</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 2px 0;">
                        <span>Power</span>
                        <span id="power_consumption">150 kW</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 2px 0;">
                        <span>OpEx</span>
                        <span id="operating_cost">$485/h</span>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">🔧 QUICK ACTIONS</div>
                <div class="quick-actions">
                    <button class="action-btn" onclick="quickAction('optimize')">Optimize</button>
                    <button class="action-btn" onclick="quickAction('steady')">Steady</button>
                </div>
                <div class="quick-actions">
                    <button class="action-btn" onclick="quickAction('shutdown')">Shutdown</button>
                    <button class="action-btn" onclick="quickAction('startup')">Startup</button>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">📈 PROCESS HEALTH</div>
                <div style="font-size: 10px;">
                    <div style="display: flex; justify-content: space-between; margin: 2px 0;">
                        <span>Separation Efficiency</span>
                        <span style="color: #48bb78;" id="sep_efficiency">94.2%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 2px 0;">
                        <span>Energy Efficiency</span>
                        <span style="color: #48bb78;" id="energy_efficiency">87.3%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 2px 0;">
                        <span>Vacuum Stability</span>
                        <span style="color: #48bb78;" id="vacuum_stability">±0.5%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 2px 0;">
                        <span>Overall Performance</span>
                        <span style="color: #48bb78;" id="overall_performance">91.8%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Status Bar -->
        <div class="status-bar">
            <div>
                <span>🌡️ Avg Temp: <span id="avg_temp">315.2°C</span></span>
                <span style="margin-left: 20px;">📊 Mass Balance: <span id="mass_balance">99.2%</span></span>
            </div>
            <div>
                <span>Last Update: <span id="last_update">2s ago</span></span>
                <span style="margin-left: 20px;">Version: VDU-SCADA v2.1.4</span>
            </div>
        </div>
    </div>
    
    <!-- Popup Overlay -->
    <div class="popup-overlay" id="popupOverlay">
        <div class="popup-content">
            <button class="popup-close" onclick="closePopup()">×</button>
            <div class="popup-header" id="popupHeader">Equipment Details</div>
            <div id="popupBody">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Global simulation state
        let simulationData = {
            feedRate: 250.5,
            topTemp: 245.2,
            bottomTemp: 385.8,
            feedTemp: 355.1,
            vacuum: 40.2,
            reflux: 625.0,
            reboilerDuty: 89.7,
            condenserDuty: 65.2,
            alarmCount: 2,
            trayTemperatures: [],
            controllers: {
                TIC101: { pv: 245.2, sp: 245.0, output: 67.5, mode: 'AUTO' },
                PIC101: { pv: 40.2, sp: 40.0, output: 58.9, mode: 'AUTO' },
                FIC101: { pv: 250.5, sp: 250.0, output: 65.2, mode: 'AUTO' },
                LIC101: { pv: 68.5, sp: 70.0, output: 45.3, mode: 'AUTO' }
            },
            productFlows: {
                hvgo: 37.5,
                lvgo: 62.5,
                spindle: 50.0,
                heavyNeutral: 45.0,
                residuum: 55.0
            }
        };
        
        let currentView = 'overview';
        let miniCharts = {};
        
        // Initialize SCADA system
        function initializeSCADA() {
            console.log('Initializing Professional SCADA System...');
            
            // Calculate initial tray temperatures
            calculateTrayTemperatures();
            
            // Initialize mini charts
            initializeMiniCharts();
            
            // Start simulation loop
            setInterval(updateSimulation, 3000); // Every 3 seconds
            setInterval(updateClock, 1000); // Every second
            
            // Initial update
            updateAllDisplays();
        }
        
        function calculateTrayTemperatures() {
            const { topTemp, bottomTemp } = simulationData;
            simulationData.trayTemperatures = [];
            
            for (let i = 1; i <= 25; i++) {
                const position = (i - 1) / 24;
                const baseTemp = topTemp + (bottomTemp - topTemp) * Math.pow(position, 1.3);
                const noise = (Math.random() - 0.5) * 2;
                simulationData.trayTemperatures.push(baseTemp + noise);
            }
        }
        
        function updateSimulation() {
            // Add process variations
            simulationData.topTemp += (Math.random() - 0.5) * 1.5;
            simulationData.bottomTemp += (Math.random() - 0.5) * 2.0;
            simulationData.vacuum += (Math.random() - 0.5) * 0.8;
            simulationData.feedRate += (Math.random() - 0.5) * 3.0;
            
            // Keep within realistic bounds
            simulationData.topTemp = Math.max(240, Math.min(250, simulationData.topTemp));
            simulationData.bottomTemp = Math.max(380, Math.min(390, simulationData.bottomTemp));
            simulationData.vacuum = Math.max(35, Math.min(45, simulationData.vacuum));
            simulationData.feedRate = Math.max(240, Math.min(260, simulationData.feedRate));
            
            // Recalculate dependent values
            simulationData.feedTemp = (simulationData.topTemp + simulationData.bottomTemp) / 2 + 10;
            calculateTrayTemperatures();
            updateProductFlows();
            updateControllers();
            checkAlarms();
            updateAllDisplays();
        }
        
        function updateProductFlows() {
            const totalFeed = simulationData.feedRate;
            simulationData.productFlows = {
                hvgo: (totalFeed * 0.15).toFixed(1),
                lvgo: (totalFeed * 0.25).toFixed(1),
                spindle: (totalFeed * 0.20).toFixed(1),
                heavyNeutral: (totalFeed * 0.18).toFixed(1),
                residuum: (totalFeed * 0.22).toFixed(1)
            };
        }
        
        function updateControllers() {
            // Simple controller simulation
            Object.keys(simulationData.controllers).forEach(tag => {
                const controller = simulationData.controllers[tag];
                const error = controller.sp - controller.pv;
                controller.output = Math.max(0, Math.min(100, 50 + error * 2));
            });
        }
        
        function updateAllDisplays() {
            // Update KPIs
            document.getElementById('kpi_throughput').textContent = simulationData.feedRate.toFixed(1);
            document.getElementById('kpi_vacuum').textContent = simulationData.vacuum.toFixed(1);
            document.getElementById('kpi_efficiency').textContent = (92 + Math.random() * 4).toFixed(1);
            document.getElementById('kpi_energy').textContent = simulationData.reboilerDuty.toFixed(1);
            
            // Update temperatures
            document.getElementById('temp_top').textContent = simulationData.topTemp.toFixed(1);
            document.getElementById('temp_feed').textContent = simulationData.feedTemp.toFixed(1);
            document.getElementById('temp_bottom').textContent = simulationData.bottomTemp.toFixed(1);
            document.getElementById('temp_delta').textContent = (simulationData.bottomTemp - simulationData.topTemp).toFixed(1);
            
            // Update instrument values on P&ID
            document.getElementById('TI101_value').textContent = simulationData.topTemp.toFixed(1) + '°C';
            document.getElementById('PI101_value').textContent = simulationData.vacuum.toFixed(1) + ' mmHg';
            document.getElementById('FI101_value').textContent = simulationData.feedRate.toFixed(1) + ' m³/h';
            document.getElementById('TI110_value').textContent = simulationData.trayTemperatures[9].toFixed(1) + '°C';
            document.getElementById('TI116_value').textContent = simulationData.feedTemp.toFixed(1) + '°C';
            document.getElementById('TI125_value').textContent = simulationData.bottomTemp.toFixed(1) + '°C';
            document.getElementById('LI101_value').textContent = (68 + Math.random() * 4).toFixed(1) + '%';
            
            // Update controller outputs
            document.getElementById('TIC101_output').textContent = simulationData.controllers.TIC101.output.toFixed(1) + '%';
            document.getElementById('PIC101_output').textContent = simulationData.controllers.PIC101.output.toFixed(1) + '%';
            document.getElementById('FIC101_output').textContent = simulationData.controllers.FIC101.output.toFixed(1) + '%';
            document.getElementById('LIC101_output').textContent = simulationData.controllers.LIC101.output.toFixed(1) + '%';
            
            // Update product flows
            document.getElementById('hvgo_flow').textContent = simulationData.productFlows.hvgo + ' m³/h';
            document.getElementById('lvgo_flow').textContent = simulationData.productFlows.lvgo + ' m³/h';
            document.getElementById('spindle_flow').textContent = simulationData.productFlows.spindle + ' m³/h';
            document.getElementById('hn_flow').textContent = simulationData.productFlows.heavyNeutral + ' m³/h';
            document.getElementById('resid_flow').textContent = simulationData.productFlows.residuum + ' m³/h';
            
            // Update utilities
            document.getElementById('steam_flow').textContent = '8,500 kg/h';
            document.getElementById('cw_flow').textContent = '450 m³/h';
            document.getElementById('power_consumption').textContent = '150 kW';
            document.getElementById('operating_cost').textContent = '$485/h';
            
            // Update process health
            document.getElementById('sep_efficiency').textContent = (94 + Math.random() * 2).toFixed(1) + '%';
            document.getElementById('energy_efficiency').textContent = (87 + Math.random() * 3).toFixed(1) + '%';
            document.getElementById('vacuum_stability').textContent = '±' + (Math.random() * 1).toFixed(1) + '%';
            document.getElementById('overall_performance').textContent = (91 + Math.random() * 3).toFixed(1) + '%';
            
            // Update status bar
            const avgTemp = simulationData.trayTemperatures.reduce((a, b) => a + b, 0) / 25;
            document.getElementById('avg_temp').textContent = avgTemp.toFixed(1) + '°C';
            document.getElementById('mass_balance').textContent = (99 + Math.random() * 1).toFixed(1) + '%';
            document.getElementById('last_update').textContent = 'now';
            
            // Update mini charts
            updateMiniCharts();
        }
        
        function checkAlarms() {
            const alarms = [];
            
            // Check for critical temperatures
            simulationData.trayTemperatures.forEach((temp, index) => {
                if (temp > 430) {
                    alarms.push({
                        time: new Date().toLocaleTimeString(),
                        message: `TI-T${(index + 1).toString().padStart(2, '0')} High Temp Warning`,
                        detail: `${temp.toFixed(1)}°C > 430°C`,
                        level: 'warning'
                    });
                }
            });
            
            // Check vacuum
            if (simulationData.vacuum > 50) {
                alarms.push({
                    time: new Date().toLocaleTimeString(),
                    message: 'PI-101 Poor Vacuum',
                    detail: `${simulationData.vacuum.toFixed(1)} mmHg > 50 mmHg`,
                    level: 'critical'
                });
            }
            
            simulationData.alarmCount = alarms.length;
            document.getElementById('alarmCount').textContent = alarms.length + ' ALARMS';
            
            // Update alarms list (keep last 5)
            updateAlarmsList(alarms.slice(0, 5));
        }
        
        function updateAlarmsList(alarms) {
            const container = document.getElementById('alarmsList');
            container.innerHTML = '';
            
            alarms.forEach(alarm => {
                const div = document.createElement('div');
                div.className = `alarm-item alarm-${alarm.level}`;
                div.onclick = () => acknowledgeAlarm(div);
                div.innerHTML = `
                    <div>${alarm.time} - ${alarm.message}</div>
                    <div style="font-size: 8px; color: #a0aec0;">${alarm.detail}</div>
                `;
                container.appendChild(div);
            });
            
            if (alarms.length === 0) {
                container.innerHTML = '<div class="alarm-item alarm-info"><div>No active alarms</div></div>';
            }
        }
        
        function initializeMiniCharts() {
            // Initialize mini temperature chart
            const tempCtx = document.getElementById('miniTempChart').getContext('2d');
            miniCharts.temperature = new Chart(tempCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 10}, (_, i) => ''),
                    datasets: [{
                        data: Array.from({length: 10}, () => Math.random() * 50 + 200),
                        borderColor: '#e53e3e',
                        backgroundColor: 'rgba(229, 62, 62, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    }
                }
            });
            
            // Initialize mini pressure chart
            const pressCtx = document.getElementById('miniPressChart').getContext('2d');
            miniCharts.pressure = new Chart(pressCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 10}, (_, i) => ''),
                    datasets: [{
                        data: Array.from({length: 10}, () => Math.random() * 10 + 35),
                        borderColor: '#48bb78',
                        backgroundColor: 'rgba(72, 187, 120, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    }
                }
            });
        }
        
        function updateMiniCharts() {
            // Update temperature chart
            if (miniCharts.temperature) {
                const data = miniCharts.temperature.data.datasets[0].data;
                data.shift();
                data.push(simulationData.topTemp);
                miniCharts.temperature.update('none');
            }
            
            // Update pressure chart
            if (miniCharts.pressure) {
                const data = miniCharts.pressure.data.datasets[0].data;
                data.shift();
                data.push(simulationData.vacuum);
                miniCharts.pressure.update('none');
            }
        }
        
        function updateClock() {
            document.getElementById('currentTime').textContent = new Date().toLocaleTimeString();
        }
        
        // Event handlers
        function showEquipmentDetail(equipment) {
            const details = {
                'tower': {
                    title: 'C-101: Vacuum Distillation Tower',
                    content: `
                        <div><strong>Equipment Type:</strong> Tray Column</div>
                        <div><strong>Height:</strong> 45 meters</div>
                        <div><strong>Diameter:</strong> 3.2 meters</div>
                        <div><strong>Number of Trays:</strong> 25 (Sieve type)</div>
                        <div><strong>Operating Pressure:</strong> ${simulationData.vacuum.toFixed(1)} mmHg abs</div>
                        <div><strong>Feed Tray:</strong> Tray 16</div>
                        <div><strong>Material:</strong> 316L Stainless Steel</div>
                        <div><strong>Design Temperature:</strong> 450°C</div>
                        <div><strong>Design Pressure:</strong> 100 mmHg abs</div>
                        <div><strong>Tray Spacing:</strong> 610 mm</div>
                        <div><strong>Weir Height:</strong> 50 mm</div>
                        <div><strong>Active Area:</strong> 6.8 m²</div>
                        <div><strong>Current Throughput:</strong> ${simulationData.feedRate.toFixed(1)} m³/h</div>
                        <div><strong>Current Status:</strong> <span style="color: #48bb78;">Online - Normal Operation</span></div>
                        <div><strong>Last Inspection:</strong> 2023-10-15</div>
                        <div><strong>Next Shutdown:</strong> 2024-09-20</div>
                    `
                },
                'condenser': {
                    title: 'E-101: Overhead Condenser',
                    content: `
                        <div><strong>Type:</strong> Shell & Tube Heat Exchanger</div>
                        <div><strong>Service:</strong> Vapor Condensation</div>
                        <div><strong>Heat Duty:</strong> ${simulationData.condenserDuty.toFixed(1)} MW</div>
                        <div><strong>Heat Transfer Area:</strong> 850 m²</div>
                        <div><strong>Shell Side:</strong> Process Vapor</div>
                        <div><strong>Tube Side:</strong> Cooling Water</div>
                        <div><strong>Inlet Temperature:</strong> ${simulationData.topTemp.toFixed(1)}°C</div>
                        <div><strong>Outlet Temperature:</strong> 35°C</div>
                        <div><strong>CW Inlet Temp:</strong> 32°C</div>
                        <div><strong>CW Outlet Temp:</strong> 42°C</div>
                        <div><strong>CW Flow Rate:</strong> 450 m³/h</div>
                        <div><strong>Tubes:</strong> 1,200 x 25mm OD x 6m long</div>
                        <div><strong>Material:</strong> 316L SS / Admiralty Brass</div>
                        <div><strong>Current Status:</strong> <span style="color: #48bb78;">Operating Normal</span></div>
                        <div><strong>Fouling Factor:</strong> 0.0002 m²K/W</div>
                        <div><strong>Last Cleaning:</strong> 2024-03-10</div>
                    `
                },
                'reboiler': {
                    title: 'E-102: Column Reboiler',
                    content: `
                        <div><strong>Type:</strong> Thermosiphon Reboiler</div>
                        <div><strong>Service:</strong> Column Heating</div>
                        <div><strong>Heat Duty:</strong> ${simulationData.reboilerDuty.toFixed(1)} MW</div>
                        <div><strong>Heat Transfer Area:</strong> 1,200 m²</div>
                        <div><strong>Shell Side:</strong> LP Steam (3.5 barg)</div>
                        <div><strong>Tube Side:</strong> Column Bottoms</div>
                        <div><strong>Steam Rate:</strong> 8,500 kg/h</div>
                        <div><strong>Steam Temperature:</strong> 143°C</div>
                        <div><strong>Process Inlet:</strong> ${simulationData.bottomTemp.toFixed(1)}°C</div>
                        <div><strong>Process Outlet:</strong> ${(simulationData.bottomTemp + 5).toFixed(1)}°C</div>
                        <div><strong>Circulation Rate:</strong> 3:1</div>
                        <div><strong>Tubes:</strong> 800 x 32mm OD x 8m long</div>
                        <div><strong>Material:</strong> Carbon Steel / 316L SS</div>
                        <div><strong>Current Status:</strong> <span style="color: #48bb78;">Operating Normal</span></div>
                        <div><strong>Steam Trap:</strong> Operational</div>
                        <div><strong>Last Maintenance:</strong> 2024-02-20</div>
                    `
                },
                'reflux-drum': {
                    title: 'V-101: Reflux Drum',
                    content: `
                        <div><strong>Type:</strong> Horizontal Separator Vessel</div>
                        <div><strong>Service:</strong> Vapor-Liquid Separation</div>
                        <div><strong>Diameter:</strong> 1.8 m</div>
                        <div><strong>Length:</strong> 5.4 m</div>
                        <div><strong>Volume:</strong> 12 m³</div>
                        <div><strong>Current Level:</strong> ${(68 + Math.random() * 4).toFixed(1)}%</div>
                        <div><strong>Normal Level Range:</strong> 40-80%</div>
                        <div><strong>Design Pressure:</strong> 150 mmHg abs</div>
                        <div><strong>Operating Pressure:</strong> ${(simulationData.vacuum + 5).toFixed(1)} mmHg abs</div>
                        <div><strong>Design Temperature:</strong> 100°C</div>
                        <div><strong>Operating Temperature:</strong> 45°C</div>
                        <div><strong>Material:</strong> 316L Stainless Steel</div>
                        <div><strong>Internals:</strong> Wire Mesh Demister</div>
                        <div><strong>Reflux Flow:</strong> ${simulationData.reflux.toFixed(0)} m³/h</div>
                        <div><strong>Current Status:</strong> <span style="color: #48bb78;">Normal Operation</span></div>
                        <div><strong>Last Inspection:</strong> 2023-11-25</div>
                    `
                },
                'vacuum-pump': {
                    title: 'P-101: Vacuum Ejector System',
                    content: `
                        <div><strong>Type:</strong> Three-Stage Steam Ejector</div>
                        <div><strong>Service:</strong> Vacuum Generation</div>
                        <div><strong>Suction Pressure:</strong> ${simulationData.vacuum.toFixed(1)} mmHg abs</div>
                        <div><strong>Discharge Pressure:</strong> Atmospheric</div>
                        <div><strong>Capacity:</strong> 2,500 kg/h air equivalent</div>
                        <div><strong>Motive Steam:</strong> HP Steam (8 barg)</div>
                        <div><strong>Steam Consumption:</strong> 2,100 kg/h</div>
                        <div><strong>1st Stage Ejector:</strong> Operating</div>
                        <div><strong>2nd Stage Ejector:</strong> Operating</div>
                        <div><strong>3rd Stage Ejector:</strong> Operating</div>
                        <div><strong>Inter-condenser 1:</strong> Normal</div>
                        <div><strong>Inter-condenser 2:</strong> Normal</div>
                        <div><strong>After-condenser:</strong> Normal</div>
                        <div><strong>Seal Water System:</strong> 15 m³/h</div>
                        <div><strong>Current Performance:</strong> 94.2%</div>
                        <div><strong>Current Status:</strong> <span style="color: #48bb78;">All Stages Online</span></div>
                        <div><strong>Last Service:</strong> 2024-01-15</div>
                        <div><strong>Next Service:</strong> 2024-07-15</div>
                    `
                }
            };
            
            if (details[equipment]) {
                showPopup(details[equipment].title, details[equipment].content);
            }
        }
        
        function showDetails(type) {
            const details = {
                'throughput': {
                    title: 'Feed Throughput Analysis',
                    content: `
                        <div><strong>Current Feed Rate:</strong> ${simulationData.feedRate.toFixed(2)} m³/h</div>
                        <div><strong>Design Capacity:</strong> 300 m³/h</div>
                        <div><strong>Utilization:</strong> ${(simulationData.feedRate/300*100).toFixed(1)}%</div>
                        <div><strong>Feed Temperature:</strong> ${simulationData.feedTemp.toFixed(1)}°C</div>
                        <div><strong>Feed API Gravity:</strong> 18.5°</div>
                        <div><strong>Daily Average:</strong> ${(simulationData.feedRate * 24).toFixed(0)} m³/day</div>
                        <div><strong>Monthly Target:</strong> 180,000 m³</div>
                        <div><strong>Status:</strong> <span style="color: #48bb78;">Within Normal Range</span></div>
                    `
                },
                'vacuum': {
                    title: 'Vacuum System Performance',
                    content: `
                        <div><strong>Current Vacuum:</strong> ${simulationData.vacuum.toFixed(2)} mmHg abs</div>
                        <div><strong>Target Range:</strong> 35-45 mmHg abs</div>
                        <div><strong>Ejector Performance:</strong> 94.2%</div>
                        <div><strong>Steam Consumption:</strong> 2,100 kg/h</div>
                        <div><strong>Sealing Water:</strong> 15 m³/h</div>
                        <div><strong>Vacuum Stability:</strong> ±0.5%</div>
                        <div><strong>Last Maintenance:</strong> 2024-01-15</div>
                        <div><strong>Status:</strong> <span style="color: #48bb78;">Optimal Performance</span></div>
                    `
                },
                'efficiency': {
                    title: 'Process Efficiency Metrics',
                    content: `
                        <div><strong>Overall Recovery:</strong> ${document.getElementById('kpi_efficiency').textContent}%</div>
                        <div><strong>HVGO Recovery:</strong> 94.2%</div>
                        <div><strong>LVGO Recovery:</strong> 91.8%</div>
                        <div><strong>Spindle Recovery:</strong> 89.5%</div>
                        <div><strong>Energy Efficiency:</strong> 87.3%</div>
                        <div><strong>Separation Factor:</strong> 2.45</div>
                        <div><strong>Theoretical Trays:</strong> 18.5</div>
                        <div><strong>Actual Trays:</strong> 25</div>
                        <div><strong>Column Efficiency:</strong> 74%</div>
                    `
                },
                'energy': {
                    title: 'Energy Consumption Analysis',
                    content: `
                        <div><strong>Reboiler Duty:</strong> ${simulationData.reboilerDuty.toFixed(1)} MW</div>
                        <div><strong>Condenser Duty:</strong> ${simulationData.condenserDuty.toFixed(1)} MW</div>
                        <div><strong>Net Energy:</strong> ${(simulationData.reboilerDuty - simulationData.condenserDuty).toFixed(1)} MW</div>
                        <div><strong>Steam Rate:</strong> 8,500 kg/h</div>
                        <div><strong>Steam Cost:</strong> $212.50/h</div>
                        <div><strong>Cooling Water:</strong> 450 m³/h</div>
                        <div><strong>Electricity:</strong> 150 kW</div>
                        <div><strong>Total OpEx:</strong> $485.60/h</div>
                    `
                }
            };
            
            if (details[type]) {
                showPopup(details[type].title, details[type].content);
            }
        }
        
        function showTrendDetail(type) {
            const trendDetails = {
                'temperature': {
                    title: 'Temperature Trend Analysis',
                    content: `
                        <div><strong>Current Trend:</strong> Stable</div>
                        <div><strong>Top Temperature:</strong> ${simulationData.topTemp.toFixed(1)}°C</div>
                        <div><strong>Bottom Temperature:</strong> ${simulationData.bottomTemp.toFixed(1)}°C</div>
                        <div><strong>Temperature Delta:</strong> ${(simulationData.bottomTemp - simulationData.topTemp).toFixed(1)}°C</div>
                        <div><strong>Feed Tray Temperature:</strong> ${simulationData.feedTemp.toFixed(1)}°C</div>
                        <div><strong>Average Rate of Change:</strong> ±0.2°C/min</div>
                        <div><strong>Alarm Limits:</strong> 450°C High / 150°C Low</div>
                        <div><strong>Trend Status:</strong> <span style="color: #48bb78;">Normal Variation</span></div>
                    `
                },
                'pressure': {
                    title: 'Pressure Trend Analysis',  
                    content: `
                        <div><strong>Current Trend:</strong> Stable</div>
                        <div><strong>Column Vacuum:</strong> ${simulationData.vacuum.toFixed(1)} mmHg abs</div>
                        <div><strong>Pressure Drop:</strong> 12.5 mmHg</div>
                        <div><strong>Ejector Suction:</strong> 28.2 mmHg abs</div>
                        <div><strong>Steam Pressure:</strong> 3.5 barg</div>
                        <div><strong>Stability Index:</strong> 98.5%</div>
                        <div><strong>Control Performance:</strong> Excellent</div>
                        <div><strong>Status:</strong> <span style="color: #48bb78;">Within Specification</span></div>
                    `
                }
            };
            
            if (trendDetails[type]) {
                showPopup(trendDetails[type].title, trendDetails[type].content);
            }
        }
        
        function showValve(valveTag) {
            const valveDetails = {
                'FCV-101': {
                    title: 'FCV-101: Feed Flow Control Valve',
                    content: `
                        <div><strong>Valve Type:</strong> Globe Valve, Pneumatic Actuator</div>
                        <div><strong>Size:</strong> 8" (DN200)</div>
                        <div><strong>Current Position:</strong> ${simulationData.controllers.FIC101.output.toFixed(1)}%</div>
                        <div><strong>Flow Coefficient (Cv):</strong> 185</div>
                        <div><strong>Control Mode:</strong> Cascade from FIC-101</div>
                        <div><strong>Actuator Signal:</strong> 4-20mA</div>
                        <div><strong>Positioner:</strong> Digital Smart Positioner</div>
                        <div><strong>Material:</strong> 316L SS / PTFE Seat</div>
                        <div><strong>Last Maintenance:</strong> 2024-02-10</div>
                        <div><strong>Status:</strong> <span style="color: #48bb78;">Normal Operation</span></div>
                    `
                },
                'FCV-102': {
                    title: 'FCV-102: Reflux Flow Control Valve',
                    content: `
                        <div><strong>Valve Type:</strong> Globe Valve, Pneumatic Actuator</div>
                        <div><strong>Size:</strong> 6" (DN150)</div>
                        <div><strong>Current Position:</strong> 71.8%</div>
                        <div><strong>Flow Coefficient (Cv):</strong> 120</div>
                        <div><strong>Control Mode:</strong> Cascade from FIC-102</div>
                        <div><strong>Status:</strong> <span style="color: #48bb78;">Normal Operation</span></div>
                    `
                },
                'PCV-101': {
                    title: 'PCV-101: Vacuum Control Valve',
                    content: `
                        <div><strong>Valve Type:</strong> Butterfly Valve, Electric Actuator</div>
                        <div><strong>Size:</strong> 12" (DN300)</div>
                        <div><strong>Current Position:</strong> ${simulationData.controllers.PIC101.output.toFixed(1)}%</div>
                        <div><strong>Control Mode:</strong> Cascade from PIC-101</div>
                        <div><strong>Status:</strong> <span style="color: #48bb78;">Normal Operation</span></div>
                    `
                }
            };
            
            if (valveDetails[valveTag]) {
                showPopup(valveDetails[valveTag].title, valveDetails[valveTag].content);
            }
        }
        
        function switchView(view) {
            currentView = view;
            console.log('Switching to view:', view);
            
            // Update tab appearance
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Find and activate the clicked tab
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                const tabText = tab.textContent.toLowerCase();
                if (tabText === view || (view === 'maintenance' && tabText === 'maint')) {
                    tab.classList.add('active');
                }
            });
            
            // Show content based on view
            setTimeout(() => {
                if (view === 'overview') {
                    showPopup('📊 Overview Dashboard', `
                        <div style="font-size: 14px; line-height: 1.6;">
                            <div><strong>🏭 Current Operation Status:</strong></div><br>
                            <div>• Unit Throughput: <span style="color: #48bb78;">250.5 m³/h</span></div>
                            <div>• Vacuum Performance: <span style="color: #48bb78;">40.2 mmHg abs</span></div>
                            <div>• Energy Efficiency: <span style="color: #48bb78;">87.3%</span></div>
                            <div>• Product Recovery: <span style="color: #48bb78;">94.2%</span></div>
                            <br>
                            <div style="color: #48bb78; font-size: 16px;"><strong>✅ Overall Status: NORMAL OPERATION</strong></div>
                        </div>
                    `);
                } else if (view === 'control') {
                    showPopup('🎛️ Control Center', `
                        <div style="font-size: 14px; line-height: 1.6;">
                            <div><strong>🔄 Active Control Loops:</strong></div><br>
                            <div>• TIC-101: Top Temperature Control - <span style="color: #48bb78;">AUTO</span></div>
                            <div>• PIC-101: Vacuum Pressure Control - <span style="color: #48bb78;">AUTO</span></div>
                            <div>• FIC-101: Feed Flow Control - <span style="color: #48bb78;">AUTO</span></div>
                            <div>• LIC-101: Reflux Drum Level - <span style="color: #48bb78;">AUTO</span></div>
                            <br>
                            <div style="color: #48bb78;"><strong>✅ All controllers in AUTO mode</strong></div>
                        </div>
                    `);
                } else if (view === 'trends') {
                    showPopup('📈 Trend Analysis Center', `
                        <div style="font-size: 14px; line-height: 1.6;">
                            <div><strong>📊 Available Real-time Trends:</strong></div><br>
                            <div>• Temperature Profile (25 measurement points)</div>
                            <div>• Pressure & Vacuum System Performance</div>
                            <div>• Flow Rates & Material Balance</div>
                            <div>• Product Quality Parameters</div>
                            <br>
                            <div><strong>🗃️ Historical Data Archive:</strong></div>
                            <div>• Data Resolution: <span style="color: #3182ce;">1 minute intervals</span></div>
                            <div>• Archive Status: <span style="color: #48bb78;">Active & Healthy</span></div>
                        </div>
                    `);
                } else if (view === 'maintenance') {
                    showPopup('🔧 Maintenance Management', `
                        <div style="font-size: 14px; line-height: 1.6;">
                            <div><strong>📅 Scheduled Maintenance:</strong></div><br>
                            <div>🔧 Vacuum Ejector Service: <span style="color: #ed8936;">2024-07-15</span></div>
                            <div>🔧 Column Inspection: <span style="color: #ed8936;">2024-09-20</span></div>
                            <div>🔧 Instrument Calibration: <span style="color: #ed8936;">2024-07-01</span></div>
                            <br>
                            <div style="color: #48bb78; font-size: 16px;"><strong>✅ Equipment Health: EXCELLENT</strong></div>
                        </div>
                    `);
                }
            }, 100);
        }
        
        function quickAction(action) {
            console.log('Quick action:', action);
            
            setTimeout(() => {
                if (action === 'optimize') {
                    showPopup('🚀 Process Optimization', `
                        <div style="font-size: 14px; line-height: 1.6;">
                            <div><strong>🔄 Running Optimization Algorithm...</strong></div><br>
                            <div>✓ Analyzing current operating conditions</div>
                            <div>✓ Calculating optimal setpoints</div>
                            <div>✓ Validating constraints</div>
                            <br>
                            <div><strong>📊 Results:</strong></div>
                            <div>• Energy reduction: <span style="color: #48bb78;">3.2%</span></div>
                            <div>• Yield improvement: <span style="color: #48bb78;">1.8%</span></div>
                            <br>
                            <div style="color: #48bb78; font-size: 16px;"><strong>✅ Optimization completed!</strong></div>
                        </div>
                    `);
                } else if (action === 'steady') {
                    showPopup('⚖️ Steady State Control', `
                        <div style="font-size: 14px; line-height: 1.6;">
                            <div><strong>🎯 Activating Steady-State Mode...</strong></div><br>
                            <div>✓ Reducing controller aggressiveness</div>
                            <div>✓ Stabilizing key variables</div>
                            <div>✓ Monitoring disturbances</div>
                            <br>
                            <div style="color: #48bb78; font-size: 16px;"><strong>✅ Steady-state mode activated!</strong></div>
                        </div>
                    `);
                } else if (action === 'shutdown') {
                    if (confirm('⚠️ WARNING: This will initiate controlled shutdown. Continue?')) {
                        showPopup('🛑 Shutdown Procedure', `
                            <div style="font-size: 14px; line-height: 1.6;">
                                <div style="color: #e53e3e;"><strong>⚠️ Controlled Shutdown Initiated</strong></div><br>
                                <div>🔄 Feed flow reduction in progress...</div>
                                <div>🔄 Steam reduction to reboiler...</div>
                                <div>🔄 Product withdrawal...</div>
                                <br>
                                <div><strong>⏱️ Estimated completion: 90 minutes</strong></div>
                            </div>
                        `);
                    }
                } else if (action === 'startup') {
                    showPopup('🟢 Startup Procedure', `
                        <div style="font-size: 14px; line-height: 1.6;">
                            <div><strong>🚀 Startup Sequence Initiated</strong></div><br>
                            <div>✓ Pre-startup checks completed</div>
                            <div>✓ Vacuum system startup</div>
                            <div>🔄 Steam introduction...</div>
                            <div>🔄 Feed introduction...</div>
                            <br>
                            <div style="color: #48bb78; font-size: 16px;"><strong>✅ Startup proceeding normally!</strong></div>
                        </div>
                    `);
                }
            }, 100);
        }
        
        function showInstrument(tag) {
            const instruments = {
                'TI-101': {
                    title: 'TI-101: Top Temperature Indicator',
                    content: `
                        <div><strong>Current Value:</strong> ${simulationData.topTemp.toFixed(2)}°C</div>
                        <div><strong>Range:</strong> 0-500°C</div>
                        <div><strong>Accuracy:</strong> ±0.5°C</div>
                        <div><strong>Type:</strong> RTD Pt-100</div>
                        <div><strong>Signal:</strong> 4-20mA</div>
                        <div><strong>Location:</strong> Top of Column</div>
                        <div><strong>DCS Tag:</strong> AI-101</div>
                        <div><strong>Alarm High:</strong> 250°C</div>
                        <div><strong>Alarm Low:</strong> 200°C</div>
                        <div><strong>Last Calibration:</strong> 2024-02-15</div>
                        <div><strong>Next Calibration:</strong> 2024-08-15</div>
                        <div><strong>Status:</strong> <span style="color: #48bb78;">Normal</span></div>
                    `
                },
                'TI-110': {
                    title: 'TI-110: HVGO Draw Temperature',
                    content: `
                        <div><strong>Current Value:</strong> ${simulationData.trayTemperatures[9].toFixed(2)}°C</div>
                        <div><strong>Range:</strong> 200-400°C</div>
                        <div><strong>Accuracy:</strong> ±0.5°C</div>
                        <div><strong>Type:</strong> RTD Pt-100</div>
                        <div><strong>Signal:</strong> 4-20mA</div>
                        <div><strong>Location:</strong> Tray 10 - HVGO Section</div>
                        <div><strong>DCS Tag:</strong> AI-110</div>
                        <div><strong>Alarm High:</strong> 320°C</div>
                        <div><strong>Alarm Low:</strong> 280°C</div>
                        <div><strong>Cut Point Control:</strong> 340-380°C</div>
                        <div><strong>Product Quality:</strong> Heavy VGO</div>
                        <div><strong>Status:</strong> <span style="color: #48bb78;">Normal</span></div>
                    `
                },
                'TI-116': {
                    title: 'TI-116: Feed Tray Temperature',
                    content: `
                        <div><strong>Current Value:</strong> ${simulationData.feedTemp.toFixed(2)}°C</div>
                        <div><strong>Range:</strong> 250-450°C</div>
                        <div><strong>Accuracy:</strong> ±0.5°C</div>
                        <div><strong>Type:</strong> RTD Pt-100</div>
                        <div><strong>Signal:</strong> 4-20mA</div>
                        <div><strong>Location:</strong> Tray 16 - Feed Entry Point</div>
                        <div><strong>DCS Tag:</strong> AI-116</div>
                        <div><strong>Alarm High:</strong> 380°C</div>
                        <div><strong>Alarm Low:</strong> 330°C</div>
                        <div><strong>Feed Temperature:</strong> Critical Control Point</div>
                        <div><strong>Flash Zone:</strong> Optimal Vaporization</div>
                        <div><strong>Status:</strong> <span style="color: #48bb78;">Normal</span></div>
                    `
                },
                'TI-125': {
                    title: 'TI-125: Bottom Temperature Indicator',
                    content: `
                        <div><strong>Current Value:</strong> ${simulationData.bottomTemp.toFixed(2)}°C</div>
                        <div><strong>Range:</strong> 300-500°C</div>
                        <div><strong>Accuracy:</strong> ±0.5°C</div>
                        <div><strong>Type:</strong> RTD Pt-100</div>
                        <div><strong>Signal:</strong> 4-20mA</div>
                        <div><strong>Location:</strong> Bottom of Column</div>
                        <div><strong>DCS Tag:</strong> AI-125</div>
                        <div><strong>Alarm High:</strong> 420°C</div>
                        <div><strong>Alarm Low:</strong> 360°C</div>
                        <div><strong>Reboiler Control:</strong> Temperature Cascade</div>
                        <div><strong>Product:</strong> Vacuum Residuum</div>
                        <div><strong>Status:</strong> <span style="color: #48bb78;">Normal</span></div>
                    `
                },
                'PI-101': {
                    title: 'PI-101: Vacuum Pressure Indicator',
                    content: `
                        <div><strong>Current Value:</strong> ${simulationData.vacuum.toFixed(2)} mmHg abs</div>
                        <div><strong>Range:</strong> 0-200 mmHg abs</div>
                        <div><strong>Accuracy:</strong> ±0.1 mmHg</div>
                        <div><strong>Type:</strong> Absolute Pressure Transmitter</div>
                        <div><strong>Signal:</strong> 4-20mA</div>
                        <div><strong>Location:</strong> Column Overhead</div>
                        <div><strong>DCS Tag:</strong> AI-102</div>
                        <div><strong>Alarm High:</strong> 60 mmHg abs</div>
                        <div><strong>Alarm Low:</strong> 20 mmHg abs</div>
                        <div><strong>Control Function:</strong> Vacuum System Performance</div>
                        <div><strong>Ejector Performance:</strong> 94.2%</div>
                        <div><strong>Status:</strong> <span style="color: #48bb78;">Normal</span></div>
                    `
                },
                'FI-101': {
                    title: 'FI-101: Feed Flow Indicator',
                    content: `
                        <div><strong>Current Value:</strong> ${simulationData.feedRate.toFixed(2)} m³/h</div>
                        <div><strong>Range:</strong> 0-400 m³/h</div>
                        <div><strong>Accuracy:</strong> ±0.5% of reading</div>
                        <div><strong>Type:</strong> Coriolis Mass Flow Meter</div>
                        <div><strong>Signal:</strong> 4-20mA</div>
                        <div><strong>Location:</strong> Feed Inlet Line</div>
                        <div><strong>DCS Tag:</strong> AI-103</div>
                        <div><strong>Line Size:</strong> 8" (DN200)</div>
                        <div><strong>Design Pressure:</strong> 25 barg</div>
                        <div><strong>Design Temperature:</strong> 450°C</div>
                        <div><strong>Alarm High:</strong> 320 m³/h</div>
                        <div><strong>Alarm Low:</strong> 180 m³/h</div>
                        <div><strong>Control Loop:</strong> FIC-101 Cascade</div>
                        <div><strong>Status:</strong> <span style="color: #48bb78;">Normal</span></div>
                    `
                },
                'LI-101': {
                    title: 'LI-101: Reflux Drum Level Indicator',
                    content: `
                        <div><strong>Current Value:</strong> ${(68 + Math.random() * 4).toFixed(1)}%</div>
                        <div><strong>Range:</strong> 0-100%</div>
                        <div><strong>Accuracy:</strong> ±1% of span</div>
                        <div><strong>Type:</strong> Guided Wave Radar</div>
                        <div><strong>Signal:</strong> 4-20mA</div>
                        <div><strong>Location:</strong> Reflux Drum V-101</div>
                        <div><strong>DCS Tag:</strong> AI-104</div>
                        <div><strong>Vessel Height:</strong> 1.8 m</div>
                        <div><strong>Normal Range:</strong> 40-80%</div>
                        <div><strong>Alarm High:</strong> 85%</div>
                        <div><strong>Alarm Low:</strong> 25%</div>
                        <div><strong>Control Function:</strong> Reflux Flow Control</div>
                        <div><strong>Interface Detection:</strong> Enabled</div>
                        <div><strong>Status:</strong> <span style="color: #48bb78;">Normal</span></div>
                    `
                }
            };
            
            if (instruments[tag]) {
                showPopup(instruments[tag].title, instruments[tag].content);
            } else {
                // Fallback for any missing instruments
                showPopup(`${tag}: Process Measurement`, `
                    <div><strong>Instrument Tag:</strong> ${tag}</div>
                    <div><strong>Status:</strong> <span style="color: #48bb78;">Online</span></div>
                    <div><strong>Signal Type:</strong> 4-20mA</div>
                    <div><strong>Communication:</strong> HART Protocol</div>
                    <div><strong>Last Calibration:</strong> 2024-01-15</div>
                    <div><strong>Next Calibration:</strong> 2024-07-15</div>
                    <div><strong>Manufacturer:</strong> Emerson/Rosemount</div>
                    <div><strong>Model:</strong> 3051CD</div>
                    <div><strong>Accuracy Class:</strong> ±0.075%</div>
                    <div><strong>Installation:</strong> Field Mounted</div>
                    <div><strong>DCS Integration:</strong> Active</div>
                `);
            }
        }
        
        function showTempProfile() {
            let content = '<div><strong>Complete Temperature Profile:</strong></div><br>';
            content += '<div style="max-height: 300px; overflow-y: auto;">';
            content += '<table style="width: 100%; font-size: 11px;">';
            content += '<tr><th>Tray</th><th>Temperature</th><th>Section</th></tr>';
            
            simulationData.trayTemperatures.forEach((temp, index) => {
                const trayNum = index + 1;
                let section = '';
                if (trayNum <= 5) section = 'Rectification';
                else if (trayNum <= 10) section = 'HVGO';
                else if (trayNum <= 15) section = 'LVGO';
                else if (trayNum === 16) section = 'FEED';
                else if (trayNum <= 20) section = 'Spindle';
                else section = 'Heavy Neutral';
                
                content += `<tr><td>T${trayNum.toString().padStart(2, '0')}</td><td>${temp.toFixed(1)}°C</td><td>${section}</td></tr>`;
            });
            
            content += '</table></div>';
            showPopup('Tower Temperature Profile', content);
        }
        
        function showPopup(title, content) {
            document.getElementById('popupHeader').textContent = title;
            document.getElementById('popupBody').innerHTML = content;
            document.getElementById('popupOverlay').style.display = 'flex';
        }
        
        function closePopup() {
            document.getElementById('popupOverlay').style.display = 'none';
        }
        
        function acknowledgeAlarm(element) {
            element.style.opacity = '0.5';
            element.style.textDecoration = 'line-through';
            setTimeout(() => {
                element.remove();
                simulationData.alarmCount = Math.max(0, simulationData.alarmCount - 1);
                document.getElementById('alarmCount').textContent = simulationData.alarmCount + ' ALARMS';
            }, 1000);
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeSCADA();
        });
        
        // Close popup on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closePopup();
            }
        });
        
    </script>
</body>
</html>
